# InventSight - Intelligent Inventory & POS System Configuration
# Current Date and Time (UTC): 2025-08-26 09:33:31
# Current User's Login: WinKyaw
# Repository: WinKyaw/InventSight

spring:
  application:
    name: inventsight-backend
    
  # PostgreSQL Configuration (Core Business Data)
  datasource:
    url: jdbc:postgresql://localhost:5432/inventsight_db
    username: inventsight_user
    password: inventsight_password_2025
    driver-class-name: org.postgresql.Driver
    
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
        # Multi-tenancy configuration - only enabled for PostgreSQL profiles
        # Will be overridden by profile-specific configurations
  
  # Flyway Configuration
  flyway:
    locations: classpath:db/migration
    baseline-on-migrate: true
    baseline-version: 0
    default-schema: public
    validate-on-migrate: true
        
  # MongoDB Configuration (Analytics & Logs)
  data:
    mongodb:
      uri: mongodb://localhost:27017/inventsight_analytics
      auto-index-creation: true
      
    # Redis Configuration (Cache & Sessions)  
    redis:
      host: localhost
      port: 6379
      timeout: 2000ms
      password: # Leave empty for local development
  
  # Email Configuration
  mail:
    host: ${EMAIL_HOST:smtp.gmail.com}
    port: ${EMAIL_PORT:587}
    username: ${EMAIL_USERNAME:windaybunce@gmail.com}
    password: ${EMAIL_PASSWORD:12345}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
            required: true
          connectiontimeout: 5000
          timeout: 5000
          writetimeout: 5000
        from: windaybunce@gmail.com
    # Email configuration notes:
    # - For Gmail: host=smtp.gmail.com, port=587, use App Password (not regular password)
    # - For Outlook: host=smtp-mail.outlook.com, port=587
    # - For SendGrid: host=smtp.sendgrid.net, port=587, username=apikey
    # - For AWS SES: host=email-smtp.{region}.amazonaws.com, port=587
    # See EMAIL_SETUP.md for detailed configuration instructions
  
  # OAuth2 Resource Server Configuration  
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: ${JWT_ISSUER_URI:#{null}}
          jwk-set-uri: ${JWT_JWK_SET_URI:#{null}}
      # OAuth2 Client Login configuration moved to application-oauth-login.yml profile
      # To enable OAuth2 Login: use --spring.profiles.active=oauth-login and set provider env vars
      
# Server Configuration
server:
  port: 8080
  servlet:
    context-path: /api
    
# Security Configuration
inventsight:
  security:
    jwt:
      secret: inventsight-super-secret-jwt-key-winkyaw-2025-08-26
      expiration: 900000 # 15 minutes (900,000 ms) - balance between security and usability
      refresh-expiration: 604800000 # 7 days
      
    oauth2:
      resource-server:
        enabled: false
        audiences: ${JWT_AUDIENCES:inventsight-api}
        clock-skew-seconds: ${JWT_CLOCK_SKEW_SECONDS:60}
      login:
        enabled: true
      
    saml:
      enabled: false
    
    # Local login/registration endpoints (enabled by default for local authentication)
    local-login:
      enabled: true
      
  system:
    name: "InventSight - Intelligent Inventory & POS System"
    version: "1.0.0"
    current-user: "WinKyaw"
    timezone: "UTC"
    current-datetime: "2025-08-26 09:33:31"
    
  database:
    sql-enabled: true
    nosql-enabled: true
    cache-enabled: true
    
  features:
    real-time-sync: true
    analytics-tracking: true
    audit-logging: true
    intelligent-forecasting: true
    
  # Tenancy Configuration
  tenancy:
    header:
      # JWT-only tenant mode (default): tenant_id must come from JWT claim
      # Set to true to allow X-Tenant-ID header (legacy mode)
      enabled: false
      # When header mode is enabled, validate X-Tenant-ID against JWT claim
      validate-against-jwt: true
      
  # Rate Limiting Configuration
  rate-limiting:
    enabled: ${RATE_LIMITING_ENABLED:true}
    per-tenant:
      requests-per-minute: ${RATE_LIMIT_TENANT_RPM:1000}
    per-ip:
      requests-per-minute: ${RATE_LIMIT_IP_RPM:100}
    auth-endpoints:
      requests-per-minute: ${RATE_LIMIT_AUTH_RPM:10}
      
  # GDPR Configuration
  gdpr:
    export:
      format: ${GDPR_EXPORT_FORMAT:json} # json, csv, or both
    retention:
      audit-fields-allowlist: actor,timestamp,action,tenant_id,company_id
      
  # Offline Sync Configuration
  sync:
    idempotency:
      enabled: ${SYNC_IDEMPOTENCY_ENABLED:true}
      ttl-hours: ${SYNC_IDEMPOTENCY_TTL:24}
    change-feed:
      enabled: ${SYNC_CHANGE_FEED_ENABLED:true}
      page-size: ${SYNC_CHANGE_FEED_PAGE_SIZE:100}
      
  # Email Provider Configuration
  email:
    provider: ${EMAIL_PROVIDER:smtp} # Options: smtp, ses, sendgrid
    from-address: ${EMAIL_FROM:windaybunce@gmail.com}
    from-name: "InventSight"
    verification-url: ${EMAIL_VERIFICATION_URL:http://localhost:3000/verify-email}
    # Email provider setup:
    # - smtp: Use spring.mail properties above for SMTP configuration
    # - ses: Requires AWS credentials and SES setup (see EMAIL_SETUP.md)
    # - sendgrid: Requires SendGrid API key (see EMAIL_SETUP.md)
    
  # Data Retention Policy
  data:
    retention:
      days: ${DATA_RETENTION_DAYS:365}
      
  # Currency Configuration
  currency:
    default-code: ${DEFAULT_CURRENCY:USD}
    fx:
      provider: ${FX_PROVIDER:mock} # Options: mock, ecb, openexchangerates
      api-key: ${FX_API_KEY:}
      cache-ttl-hours: ${FX_CACHE_TTL:24}
    
  # MFA Configuration  
  mfa:
    issuer: "InventSight"
    totp:
      window-size: 3 # Allow 3 time windows for clock skew
    otp:
      enabled: true
      expiry-minutes: 5 # OTP code validity period
      code-length: 6 # Length of OTP code
      max-attempts: 3 # Maximum verification attempts
      rate-limit-window-minutes: 10 # Rate limiting time window
      max-sends-per-window: 3 # Maximum OTP codes that can be sent in time window
      
  # SMS Configuration
  sms:
    enabled: ${SMS_ENABLED:false}
    provider: ${SMS_PROVIDER:twilio} # Options: twilio, aws-sns, nexmo
    twilio:
      account-sid: ${TWILIO_ACCOUNT_SID:}
      auth-token: ${TWILIO_AUTH_TOKEN:}
      from-number: ${TWILIO_FROM_NUMBER:}
      
  # Sales Configuration
  sales:
    enabled: ${SALES_ENABLED:true}
    max-employee-discount-percent: ${SALES_MAX_EMPLOYEE_DISCOUNT:10}
    cross-store:
      employee-requires-approval: ${SALES_CROSS_STORE_APPROVAL:true}

# Logging Configuration
logging:
  level:
    com.inventsight: DEBUG
    org.springframework.security: DEBUG
    org.hibernate.SQL: DEBUG
  file:
    name: logs/inventsight.log
    
# Management/Actuator Configuration
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
      
# OpenAPI Documentation
springdoc:
  api-docs:
    path: /docs
  swagger-ui:
    path: /swagger