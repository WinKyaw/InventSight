# New Item Setup Frontend - User Guide

## Overview

The New Item Setup page provides a complete user interface for managing predefined items (product templates) in the InventSight system. This frontend is built with vanilla HTML, CSS, and JavaScript and is served as static resources by the Spring Boot application.

## Accessing the Frontend

### URL Endpoints

- **Index Page**: `http://localhost:8080/static/index.html`
- **New Item Setup**: `http://localhost:8080/static/pages/new-item-setup.html`

### Prerequisites

1. **Running Backend**: The Spring Boot application must be running
2. **Authentication**: You need a valid JWT token with:
   - Appropriate role (FOUNDER, CEO, GENERAL_MANAGER, or Supply Management permission)
   - Company ID (tenant_id) in the JWT token
3. **Company Access**: Your user must have membership in the company

## Setup Instructions

### 1. Configure Authentication

The frontend expects authentication credentials to be stored in browser localStorage:

```javascript
// Set authentication token
localStorage.setItem('authToken', 'your-jwt-token-here');

// Set company ID (if not in JWT)
localStorage.setItem('companyId', 'your-company-uuid-here');
```

#### For Development/Testing

If you need to bypass authentication for testing, you can:

1. Enable offline mode in `application.yml`:
```yaml
inventsight:
  security:
    offline-mode:
      enabled: true
```

2. Or enable local login:
```yaml
inventsight:
  security:
    local-login:
      enabled: true
```

### 2. Start the Application

```bash
./mvnw spring-boot:run
```

Or with a specific profile:
```bash
./mvnw spring-boot:run -Dspring-boot.run.profiles=dev
```

### 3. Open in Browser

Navigate to: `http://localhost:8080/static/pages/new-item-setup.html`

## Features

### 1. Item Listing
- View all predefined items in a paginated table
- Displays: Name, Category, Unit Type, SKU, Default Price
- Automatic pagination (20 items per page)
- Loading and empty states

### 2. Search & Filter
- **Search**: Real-time search by item name (500ms debounce)
- **Category Filter**: Filter items by category
- **Clear Filters**: Reset all filters to show all items

### 3. Add New Item
- Click "+ Add Item" button
- Fill required fields:
  - Name* (supports Myanmar Unicode: ရှာလကာကြီး, ပုလင်း)
  - Unit Type* (e.g., kg, pcs, lb, တစ်လုံး)
- Optional fields:
  - Category
  - Description
  - Default Price
- SKU is auto-generated by backend
- Form validation with error messages

### 4. Edit Item
- Click pencil icon on any item
- Pre-filled form with existing data
- Update any field (except SKU)
- Myanmar Unicode support

### 5. Delete Item
- Click trash icon on any item
- Confirmation dialog appears
- Soft delete (marks as inactive, doesn't remove from database)

### 6. CSV Import
- Click "Import CSV" button
- Select CSV file
- Preview first 5 rows
- Validation warnings for missing required fields
- Detailed import results (success/failed counts)

#### CSV Format
```csv
name,category,unitType,description,defaultPrice
Apples,Fruits,lb,Fresh Red Apples,2.99
Bananas,Fruits,lb,Fresh Bananas,1.49
ရှာလကာကြီး,မုန့်,တစ်လုံး,Myanmar Item,1500
```

Required columns: `name`, `unitType`  
Optional columns: `category`, `description`, `defaultPrice`, `sku`

### 7. CSV Export
- Click "Export CSV" button
- Downloads file: `predefined-items-YYYY-MM-DD.csv`
- Includes all active items
- Preserves Myanmar Unicode

## Myanmar Unicode Support

The frontend fully supports Myanmar text:

- **Fonts**: Uses 'Myanmar Text' and 'Padauk' fonts
- **Input**: All text fields accept Myanmar characters
- **Display**: Properly renders Myanmar text in tables
- **CSV**: Import/export preserves Myanmar encoding (UTF-8)

### Example Myanmar Items
- ရှာလကာကြီး (Rice)
- ပုလင်း (Bottle)
- တစ်ကဒ် (Box)
- တစ်လုံး (Piece)

## API Integration

The frontend communicates with these backend endpoints:

### Items Management
- `GET /api/predefined-items` - List items (with pagination, search, filter)
- `POST /api/predefined-items` - Create item
- `PUT /api/predefined-items/{id}` - Update item
- `DELETE /api/predefined-items/{id}` - Delete item (soft)

### Bulk Operations
- `POST /api/predefined-items/bulk-create` - Bulk create
- `POST /api/predefined-items/import-csv` - Import CSV
- `GET /api/predefined-items/export-csv` - Export CSV

All endpoints require:
- `Authorization: Bearer <token>` header
- `companyId` query parameter

## Error Handling

The frontend handles these error scenarios:

### Network Errors
- **Message**: "Failed to connect. Please check your internet."
- **Cause**: Backend is down or unreachable

### Authentication Errors
- **401 Unauthorized**: "Session expired. Please login again."
- **403 Forbidden**: "You don't have permission to manage predefined items."

### Validation Errors
- **400 Bad Request**: Invalid data or missing required fields
- **409 Conflict**: Duplicate item (same name + unit type)

### Other Errors
- **404 Not Found**: Item not found
- **500 Internal Server Error**: Server error

All errors are displayed as toast notifications in the bottom-right corner.

## Troubleshooting

### Issue: "Company ID not found"
**Solution**: Ensure JWT token contains `tenant_id` or set in localStorage:
```javascript
localStorage.setItem('companyId', 'your-company-uuid');
```

### Issue: "403 Forbidden"
**Solution**: 
- Verify your user has GM+ role or Supply Management permission
- Check company membership

### Issue: Static resources not loading (404)
**Solution**: 
- Ensure Spring Boot is running
- Check SecurityConfig permits `/static/**`
- Verify files are in `src/main/resources/static/`

### Issue: API calls failing
**Solution**:
- Check browser console for errors
- Verify JWT token is valid and not expired
- Ensure backend API is accessible at `/api/predefined-items`

### Issue: Myanmar text not displaying
**Solution**:
- Ensure browser supports Myanmar fonts
- Check CSV file is UTF-8 encoded
- Use 'Myanmar Text' or 'Padauk' font

## Browser Compatibility

Tested and working on:
- Chrome 100+
- Firefox 100+
- Safari 15+
- Edge 100+

Requires:
- ES6 JavaScript support
- CSS Grid and Flexbox
- Fetch API

## Mobile Responsiveness

The frontend is fully responsive:
- Tablet view (768px+): Full layout
- Mobile view (<768px): Stacked layout, horizontal scroll for table

## Security Notes

1. **Authentication**: All API calls include JWT token
2. **XSS Prevention**: HTML is escaped before rendering
3. **CSRF**: Disabled in Spring Security (stateless JWT)
4. **CORS**: Configured to allow API access

## Development

### File Structure
```
src/main/resources/static/
├── index.html                    # Landing page
├── pages/
│   └── new-item-setup.html      # Main page
├── css/
│   └── new-item-setup.css       # Styles
└── js/
    ├── predefined-items-api.js  # API client
    └── new-item-setup.js        # UI controller
```

### Customization

To customize the frontend:

1. **Colors**: Edit CSS variables or gradients in `new-item-setup.css`
2. **API URL**: Modify `API_BASE_URL` in `predefined-items-api.js`
3. **Page Size**: Change default `size: 20` in API calls
4. **Debounce Time**: Adjust search timeout (default 500ms)

### Adding Features

To add new features:
1. Add UI elements in `new-item-setup.html`
2. Add styles in `new-item-setup.css`
3. Add API function in `predefined-items-api.js`
4. Add event handlers in `new-item-setup.js`

## Support

For issues or questions:
1. Check browser console for errors
2. Check Spring Boot logs
3. Verify backend API is working (use Swagger UI: `/swagger-ui.html`)
4. Review PREDEFINED_ITEMS_API.md for API documentation

## License

Copyright © 2025 InventSight. All rights reserved.
